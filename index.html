<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Toast Referral - Chat with Sarah</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; text-align:center; background:#f7f7f7; }
header { background:#ff6f00; color:white; padding:40px 20px; }
h1 { margin:0; font-size:2em; }
p { margin:20px 0; font-size:1.2em; }
a.cta, button { display:inline-block; margin:20px auto; padding:15px 30px; background:#0070f3; color:white; font-size:1.2em; border-radius:10px; border:none; cursor:pointer; text-decoration:none; }
a.cta:hover, button:hover { background:#0051a3; }
input[type="email"] { padding:10px; font-size:1em; width:250px; border-radius:5px; border:1px solid #ccc; }
footer { margin-top:40px; font-size:0.9em; color:#555; }
#chatbot { position:fixed; bottom:20px; right:20px; width:300px; max-height:400px; background:white; border:1px solid #ccc; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.2); display:flex; flex-direction:column; }
#chatMessages { flex:1; padding:10px; overflow-y:auto; font-size:0.9em; }
#chatInput { display:flex; border-top:1px solid #ccc; }
#chatInput input { flex:1; padding:10px; border:none; border-radius:0; }
#chatInput button { padding:10px; border:none; background:#0070f3; color:white; cursor:pointer; }
#qr { margin:20px auto; width:150px; height:150px; }
</style>
</head>
<body>
<header>
<h1>AI Toast Referral</h1>
<p>Chat with Sarah, your AI marketing assistant!</p>
</header>

<main>
<p>Sign up through my referral and start earning!</p>
<form id="emailForm">
<input type="email" id="email" placeholder="Enter your email" required>
<button type="submit">Submit</button>
</form>

<p>Or click below to go directly to Toast:</p>
<a class="cta" href="http://refer.toasttab.com/referred-by/AlanBlaskay/" target="_blank">Sign Up Now</a>

<div id="qr">
<img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://refer.toasttab.com/referred-by/AlanBlaskay/" alt="QR code">
</div>

<p id="confirmation" style="color:green; display:none;">Thank you! We received your email.</p>
</main>

<footer>
<p>&copy; 2025 AI Toast Referral. All rights reserved.</p>
</footer>

<!-- Chatbot -->
<div id="chatbot">
<div id="chatMessages"></div>
<div id="chatInput">
<input type="text" id="userMessage" placeholder="Ask Sarah anything...">
<button id="sendBtn">Send</button>
</div>
</div>

<script>
const LEADS_API_URL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec'; // Replace with your Apps Script URL
let conversation = [];

async function submitLead(email,message=''){
  try{
    await fetch(LEADS_API_URL,{
      method:'POST',
      body: JSON.stringify({email,email,message}),
      headers:{ 'Content-Type':'application/json' }
    });
  }catch(err){
    console.error('Lead submission error', err);
  }
}

// Email form submission
const form = document.getElementById('emailForm');
const confirmation = document.getElementById('confirmation');
form.addEventListener('submit', async e=>{
  e.preventDefault();
  const email = document.getElementById('email').value;
  confirmation.style.display='block';
  form.reset();
  await submitLead(email,'Signed up via email form');
});

// Chatbot
const chatMessages = document.getElementById('chatMessages');
const userInput = document.getElementById('userMessage');
const sendBtn = document.getElementById('sendBtn');

async function sendMessage(){
  const msg = userInput.value.trim();
  if(!msg) return;
  appendMessage('You', msg);
  userInput.value='';

  try{
    const res = await fetch('/api/chat',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ message: msg, conversation })
    });
    const data = await res.json();
    appendMessage('Sarah',data.reply);
    conversation = data.conversation; // preserve context
    await submitLead('', msg); // capture chat as lead
  }catch(err){
    appendMessage('Sarah','Sorry, something went wrong.');
    console.error(err);
  }
}

function appendMessage(sender,text){
  const div=document.createElement('div');
  div.innerHTML=`<strong>${sender}:</strong> ${text}`;
  chatMessages.appendChild(div);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

sendBtn.addEventListener('click',sendMessage);
userInput.addEventListener('keypress',e=>{if(e.key==='Enter') sendMessage();});
</script>
</body>
</html>
